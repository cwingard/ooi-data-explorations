
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Accessing PA Offshore Profiler Mooring (CP04OSPM) Telemetered CTD Data via R &#8212; OOI Data Explorations</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'R/cp04ospm_temperature';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="METBK Data Acess Example" href="../matlab/examples/coastal_arrays/example_metbk.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/NSF-OOI-RGB.png" class="logo__image only-light" alt="OOI Data Explorations - Home"/>
    <script>document.write(`<img src="../_static/NSF-OOI-RGB.png" class="logo__image only-dark" alt="OOI Data Explorations - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to OOI Data Explorations
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../python/examples/notebooks/m2m_explorations.html">Accessing OOI Data and Metadata through the M2M API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/examples/notebooks/fdchp/FdchpExample.html">FDCHP Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matlab/examples/coastal_arrays/example_metbk.html">METBK Data Acess Example</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Accessing PA Offshore Profiler Mooring (CP04OSPM) Telemetered CTD Data via R</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://jupyter.oceanobservatories.org/hub/user-redirect/git-pull?repo=https%3A//github.com/joffreyp/ooi-data-explorations&urlpath=tree/ooi-data-explorations/./R/cp04ospm_temperature.ipynb&branch=book" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/joffreyp/ooi-data-explorations" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/joffreyp/ooi-data-explorations/issues/new?title=Issue%20on%20page%20%2FR/cp04ospm_temperature.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/R/cp04ospm_temperature.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Accessing PA Offshore Profiler Mooring (CP04OSPM) Telemetered CTD Data via R</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-example-parameters">The Example Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-required-packages">Installing Required Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requesting-downloading-and-importing-data">Requesting, Downloading, and Importing Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-data">Plotting Data</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="accessing-pa-offshore-profiler-mooring-cp04ospm-telemetered-ctd-data-via-r">
<h1>Accessing PA Offshore Profiler Mooring (CP04OSPM) Telemetered CTD Data via R<a class="headerlink" href="#accessing-pa-offshore-profiler-mooring-cp04ospm-telemetered-ctd-data-via-r" title="Link to this heading">#</a></h1>
<section id="the-example-parameters">
<h2>The Example Parameters<a class="headerlink" href="#the-example-parameters" title="Link to this heading">#</a></h2>
<p>In this example we will be requesting telemetered CTD data from the Pioneer Array Offshore Profiler Mooring (CP04OSPM) for the months of February - April 2021. After requesting and downloading the data, we will make a false colored scatter plot of temperature with respect to time and depth.</p>
<p><strong>Site</strong>: <a class="reference external" href="https://oceanobservatories.org/site/cp04ospm/">CP04OSPM</a></p>
<p><strong>Node</strong>: WFP01</p>
<p><strong>Instrument</strong>: <a class="reference external" href="https://ooinet.oceanobservatories.org/data_access/?search=CP04OSPM-WFP01-03-CTDPFK000">03-CTDPFK000</a></p>
<p><strong>Method</strong>: telemetered</p>
<p><strong>Stream</strong>: ctdpf_ckl_wfp_instrument</p>
<p><strong>Start Date</strong>: 2021-02-01</p>
<p><strong>Start Time</strong>: 00:00:00</p>
<p><strong>Stop Date</strong>: 2021-04-30</p>
<p><strong>Stop Time</strong>: 23:59:59</p>
</section>
<section id="installing-required-packages">
<h2>Installing Required Packages<a class="headerlink" href="#installing-required-packages" title="Link to this heading">#</a></h2>
<p>The OOI has developed a curated R package for accessing OOI science data via the machine-to-machine interface. This package is called <a class="reference external" href="https://github.com/oceanobservatories/ooim2mr">OOIM2MR</a> and is intended to be a one stop shop for requesting and downloading science data from any stationary or mobile OOI asset.</p>
<p>In order to install OOIM2MR, you will first need to install the devtools package. Devtools allows you to install correctly formatted GitHub repositories as callable packages within your R environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;devtools&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Updating HTML index of packages in &#39;.Library&#39;

Making &#39;packages.html&#39; ...
 done
</pre></div>
</div>
</div>
</div>
<p>Once you’ve successfully installed devtools, you can install OOIM2MR using the install_github command. You may receive a Rtools warning. This can be ignored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">devtools</span><span class="o">::</span><span class="nf">install_github</span><span class="p">(</span><span class="s">&quot;oceanobservatories/ooim2mr&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Skipping install of &#39;ooim2mr&#39; from a github remote, the SHA1 (2287a1d5) has not changed since last install.
  Use `force = TRUE` to force installation
</pre></div>
</div>
</div>
</div>
<p>You will also need to install the httr and ncdf4 packages. In this example we will also be creating a plot, but there are many packages that allow you to do this. We’ll use ggplot2 for plotting and RColorBrewer for coloring. The OOIM2MR package also requires the R native stringr and jsonlite packages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;httr&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;ncdf4&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Updating HTML index of packages in &#39;.Library&#39;

Making &#39;packages.html&#39; ...
 done

Updating HTML index of packages in &#39;.Library&#39;

Making &#39;packages.html&#39; ...
 done

Updating HTML index of packages in &#39;.Library&#39;

Making &#39;packages.html&#39; ...
 done
</pre></div>
</div>
</div>
</div>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<p>After successful installation of the required packages, we can begin to import said packages and define our request parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#R Native Packages</span>
<span class="nf">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span>

<span class="c1">#CRAN Packages</span>
<span class="nf">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ncdf4</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ooim2mr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If you’re using Windows, the ncdf4 package has a bug that prevents Windows users from accessing remote NetCDF files. The work around for this is to specify a directory where you can download the files and then access them locally. Keep in mind that some of these files can be large and may take time to both download and open. In addition to specifying a directory, you’ll need to supply your OOI username and token for issuing requests to OOINet. If you are running this code as a full script, you’ll need to change the next cell to match your system and credentials.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;C:/Users/Ian/Desktop&quot;</span><span class="w">  </span><span class="c1">#Change this to match you own machine structure.</span>
<span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;OOIAPI-CEY6MNAH6MZ8TL&#39;</span><span class="w">  </span><span class="c1">#Change this to match your OOINet username.</span>
<span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;PMA94685J8&#39;</span><span class="w">  </span><span class="c1">#Change this to match your OOINet token.</span>
</pre></div>
</div>
</div>
</div>
<p>Next we can set up our request parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">site</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CP04OSPM&quot;</span><span class="w"> </span>
<span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;WFP01&quot;</span><span class="w"> </span>
<span class="n">instrument</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;03-CTDPFK000&quot;</span><span class="w"> </span>
<span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;telemetered&quot;</span><span class="w"> </span>
<span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ctdpf_ckl_wfp_instrument&quot;</span><span class="w"> </span>
<span class="n">start_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2021-02-01&quot;</span><span class="w"> </span>
<span class="n">start_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;00:00:00&quot;</span><span class="w"> </span>
<span class="n">stop_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2021-04-3&quot;</span>
<span class="n">stop_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;23:59:59&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="requesting-downloading-and-importing-data">
<h2>Requesting, Downloading, and Importing Data<a class="headerlink" href="#requesting-downloading-and-importing-data" title="Link to this heading">#</a></h2>
<p>Now that we have our directory, credentials, and request parameters, we can build a URL for issuing a request to OOI. The <a class="reference external" href="https://github.com/oceanobservatories/ooim2mr/blob/master/R/ooi_create_url.R">ooi_create_url</a> function from the OOIM2MR package uses a curated table for finding the correct URL, taking the guess work out of creating a URL with the correct syntax.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ooi_create_url</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
<span class="w">                     </span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
<span class="w">                     </span><span class="n">instrument</span><span class="o">=</span><span class="n">instrument</span><span class="p">,</span>
<span class="w">                     </span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
<span class="w">                     </span><span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
<span class="w">                     </span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
<span class="w">                     </span><span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
<span class="w">                     </span><span class="n">stop_date</span><span class="o">=</span><span class="n">stop_date</span><span class="p">,</span>
<span class="w">                     </span><span class="n">stop_time</span><span class="o">=</span><span class="n">stop_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Here is the request URL generated from the information you provided.
https://ooinet.oceanobservatories.org/api/m2m/12576/sensor/inv/CP04OSPM/WFP01/03-CTDPFK000/telemetered/ctdpf_ckl_wfp_instrument?beginDT=2021-02-01T00:00:00.000Z&amp;endDT=2021-04-3T23:59:59.999Z 
</pre></div>
</div>
</div>
</div>
<p>Now that we have the correct URL, we can submit our data request to OOINet using the <a class="reference external" href="https://github.com/oceanobservatories/ooim2mr/blob/master/R/ooi_submit_request.R">ooi_submit_request</a> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># response = ooi_submit_request(url=url,user=user,token=token)</span>
</pre></div>
</div>
</div>
</div>
<p>Requests can take anywhere between 1-30 minutes depending on the data you requested. After a request is submitted, the <a class="reference external" href="https://github.com/oceanobservatories/ooim2mr/blob/master/R/ooi_get_location.R">ooi_get_location</a> function continuously checks the status of your data request. Once it is complete, the function returns the remote locations of your data as a list of Thredds catalog URLs. Some dataset requests have paired data, which can cause problems when trying to import data from multiple files. For example, when requesting fluorometer data, you’ll also get CTD data. Setting the drop_paired parameter to TRUE allows you to scrub those extra files and get the data that you requested.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># remote = ooi_get_location(response=response,drop_paired=TRUE)</span>
</pre></div>
</div>
</div>
</div>
<p>Once the data is available, we can download it using the <a class="reference external" href="https://github.com/oceanobservatories/ooim2mr/blob/master/R/ooi_download_data.R">ooi_download_data</a> function. As stated previously, if you are using a Windows machine you need to supply a directory where you want to download the data. If you are MacOS and don’t want to download the data, you can skip the use of this function and directly input the URLs found in the remote variable into the ooi_get_data function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># local = ooi_download_data(remote,directory) #Download the data to the specified local location.</span>
</pre></div>
</div>
</div>
</div>
<p>Once the data is downloaded, we can pull it into our workspace. If you have experience with NetCDFs, you can do this on your own. The OOIM2MR package also provides the <a class="reference external" href="https://github.com/oceanobservatories/ooim2mr/blob/master/R/ooi_get_data.R">ooi_get_data</a> function which simplifies the data import process. If using the ooi_get_data function, the simplify_data parameter will remove non L1 or L2 variable types and engineering variables that can be confusing if it is set to TRUE. In this example, we set it to FALSE, which brings in all of the data in the files. If the data you are working with is multidimensional, you will need to set the simplify_data parameter to FALSE, because its functionality assumes that the data is 1D. The return of the ooi_get_data function is two lists. The first list contains the data and the second list contains a list of variables and associated units. Once data is imported, we can put each list into its own data.frame for easier access.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># data_vars = ooi_get_data(local,simplify_data=FALSE)</span>
<span class="c1"># data = data.frame(data_vars[[&#39;data&#39;]])</span>
<span class="c1"># vars = data.frame(data_vars[[&#39;variables_units&#39;]])</span>
</pre></div>
</div>
</div>
</div>
<p>If we print the vars list, we can see the variables that are available in the data we requested as well as units associated with those variables. Since we are going to plot temperature in this example, it is easy to make the mistake that we would use the “temperature” variable, but if you look at the units it is in counts. The variable that we actually want to use is “ctdpf_ckl_seawater_temperature”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># print(vars)</span>
</pre></div>
</div>
</div>
</div>
<p>You may notice that the units of “time” are seconds since 1900-01-01. We need to put that into a format that is easier to interpret. The next cell converts the “time” column from seconds since 1900-01-01 to YYYY-MM-DD HH:MM:SS in UTC.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># data$time = as.POSIXct(data$time,tz=&quot;UTC&quot;,origin=&#39;1900-01-01&#39;)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-data">
<h2>Plotting Data<a class="headerlink" href="#plotting-data" title="Link to this heading">#</a></h2>
<p>At this point, our data is in our workspace as a data.frame and in a format that we can interpret. Next we need to setup a color palette and color gradient so that our figures look interesting. Additionally, we need to set up the lower and upper limits for our colorbar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># temp_min_lim = 6</span>
<span class="c1"># temp_max_lim = 18</span>

<span class="c1"># myPalette &lt;- colorRampPalette(rev(brewer.pal(11, &quot;Spectral&quot;)))</span>
<span class="c1"># sc &lt;- scale_colour_gradientn(colours = myPalette(100), limits=c(temp_min_lim,temp_max_lim))</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we can build our figure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># t_plot = ggplot(data,aes(time,depth,colour=ctdpf_ckl_seawater_temperature)) +</span>
<span class="c1">#   geom_point() + scale_y_reverse() + sc + </span>
<span class="c1">#   labs(x=&#39;Time&#39;,y=&#39;Depth (m)&#39;,colour = &#39;Temperature (degC)&#39;,title = &quot;CP04OSPM Temperature&quot;,subtitle=&#39;Feb-Apr 2021&#39;)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we can display our figure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># t_plot</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./R"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../matlab/examples/coastal_arrays/example_metbk.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">METBK Data Acess Example</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-example-parameters">The Example Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-required-packages">Installing Required Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requesting-downloading-and-importing-data">Requesting, Downloading, and Importing Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-data">Plotting Data</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ocean Observatories Initiative
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>