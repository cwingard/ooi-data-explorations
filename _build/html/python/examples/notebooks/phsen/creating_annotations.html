
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using Quality Flags to Create and Utilize Annotations &#8212; OOI Data Explorations</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python/examples/notebooks/phsen/creating_annotations';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Linking IFCB Targets to in-situ Data" href="../ifcb/combining_ifcb_and_environmental.html" />
    <link rel="prev" title="Assessing the pCO2 Data for the CE01ISSM-00011 7 m Platform (NSIF)" href="../pco2w/PCO2_Calculations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/NSF-OOI-RGB.png" class="logo__image only-light" alt="OOI Data Explorations - Home"/>
    <script>document.write(`<img src="../../../../_static/NSF-OOI-RGB.png" class="logo__image only-dark" alt="OOI Data Explorations - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../intro.html">
                    Welcome to OOI Data Explorations
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Python Examples</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../../python.html">Explore OOI Data with Python</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../README.html">Getting started with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../m2m_explorations.html">Using the machine-to-machine interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fdchp/FdchpExample.html">Processing FDCHP data to produce hourly momentum flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../camds/uncabled.html">Making a timelapse from uncabled CAMDS images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dosta/ooiea_uncabled_dosta_data.html">Plotting Endurance Array surface cooring dissolved oxygen data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pco2w/PCO2_Calculations.html">Assessing pCO2 Data</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Creating annotations for pH data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ifcb/combining_ifcb_and_environmental.html">Exploring Imaging FlowCytobot (IFCB) and colocated data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optaa/processing_workflow_using_the_cspp_optaa.html">Processing workflow for Optical Absorption and Attenuation (OPTAA) data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optaa/process_thredds_optaa.html">Acessing and processing OPTAA data from Thredds server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optaa/process_kdata_optaa.html">Accessing and processing OPTAA data from JupyterHub-mounted NetCDFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optaa/process_thredds_optaa_cspp.html">Accessing and processing OPTAA data from the Coastal Surface Piercing Profiler (CSPP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optaa/process_kdata_cabled_profiler_ce04osps.html">Accessing and processing cabled profiler OPTAA data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optaa/when_things_go_bad.html">Examining OPTAA instrument failure</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Matlab Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../matlab/matlab.html">Explore OOI Data with MATLAB</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../matlab/README.html">Getting started with MATLAB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../matlab/examples/coastal_arrays/example_metbk.html">METBK Data Acess Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../matlab/examples/coastal_arrays/example_adcp.html">Example ADCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../matlab/examples/global_arrays/example_apex_profiler_mooring_ctds.html">Example Apex Profiler Mooring CTDs</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">R Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../R/README.html">Getting started with R</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../R/R_test.html">This is a test for R notebooks</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://jupyter.oceanobservatories.org/hub/user-redirect/git-pull?repo=https%3A//github.com/joffreyp/ooi-data-explorations&urlpath=tree/ooi-data-explorations/./python/examples/notebooks/phsen/creating_annotations.ipynb&branch=book" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../../../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/joffreyp/ooi-data-explorations" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/joffreyp/ooi-data-explorations/issues/new?title=Issue%20on%20page%20%2Fpython/examples/notebooks/phsen/creating_annotations.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/python/examples/notebooks/phsen/creating_annotations.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using Quality Flags to Create and Utilize Annotations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#oregon-inshore-midwater-platform">Oregon Inshore Midwater Platform</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="using-quality-flags-to-create-and-utilize-annotations">
<h1>Using Quality Flags to Create and Utilize Annotations<a class="headerlink" href="#using-quality-flags-to-create-and-utilize-annotations" title="Link to this heading">#</a></h1>
<p>OOI utilizes the SAMI2-pH sensor from <a class="reference external" href="http://www.sunburstsensors.com/">Sunburst Sensors, LLC</a> to measure seawater pH at multiple locations throughout the different arrays. Assessing the quality of the data from the instrument is an involved process as there are multiple parameters produced by the instrument that are then used to calculate the seawater pH. These different measurements are subject to different sources of error, and those errors can propogate through the calculations to create an erroneous seawater pH value. Based upon the vendor documentation and Matlab code they provide to convert the raw measurements, we can create <a class="reference external" href="https://github.com/oceanobservatories/ooi-data-explorations/blob/master/python/ooi_data_explorations/uncabled/process_phsen.py#L152">a set of rules</a> from those different measurements to flag the pH data as either <code class="docutils literal notranslate"><span class="pre">pass</span></code>, <code class="docutils literal notranslate"><span class="pre">suspect</span></code> or <code class="docutils literal notranslate"><span class="pre">fail</span></code> (using the QARTOD flag values of 1, 3 and 4, respectively).</p>
<p>The resulting flags can be used to remove <code class="docutils literal notranslate"><span class="pre">fail</span></code> data from any analysis. They can also be used to help generate annotations that can be used during further Human in the Loop (HITL) QC checks of the data to help refine quality metrics for the data. The code below will show how the quality rules can be used to remove bad pH data from a time series, and how they can be used to then create annotations. The impact of using these flags is shown with a set of before and after plots of the seawater pH as a function of temperature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># load the different libraries and modules needed for the analysis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ooi_data_explorations.common</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_annotations</span><span class="p">,</span> <span class="n">load_gc_thredds</span><span class="p">,</span> <span class="n">add_annotation_qc_flags</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ooi_data_explorations.combine_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">combine_datasets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ooi_data_explorations.uncabled.process_phsen</span><span class="w"> </span><span class="kn">import</span> <span class="n">phsen_datalogger</span><span class="p">,</span> <span class="n">phsen_instrument</span><span class="p">,</span> <span class="n">quality_checks</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ooi_data_explorations.qartod.qc_processing</span><span class="w"> </span><span class="kn">import</span> <span class="n">identify_blocks</span><span class="p">,</span> <span class="n">create_annotations</span><span class="p">,</span> \
    <span class="n">process_gross_range</span><span class="p">,</span> <span class="n">process_climatology</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="oregon-inshore-midwater-platform">
<h2>Oregon Inshore Midwater Platform<a class="headerlink" href="#oregon-inshore-midwater-platform" title="Link to this heading">#</a></h2>
<p>Data from a pH sensor on the Oregon Inshore Surface Mooring (CE01ISSM) midwater platform (aka the Near Surface Instrument Frame, NSIF), deployed at 7 m depth (site depth is 25 m) is used for this analysis. Initially we are going to look at the telemetered data from Deployment 2 (October 2014 through April 2015).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup the request parameters to download the data from the M2M system</span>
<span class="n">site</span> <span class="o">=</span> <span class="s1">&#39;CE01ISSM&#39;</span>           <span class="c1"># OOI Net site designator</span>
<span class="n">node</span> <span class="o">=</span> <span class="s1">&#39;RID16&#39;</span>              <span class="c1"># OOI Net node designator</span>
<span class="n">sensor</span> <span class="o">=</span> <span class="s1">&#39;06-PHSEND000&#39;</span>     <span class="c1"># OOI Net sensor designator</span>
<span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;telemetered&#39;</span>      <span class="c1"># OOI Data delivery method</span>
<span class="n">stream</span> <span class="o">=</span> <span class="s1">&#39;phsen_abcdef_dcl_instrument&#39;</span>   <span class="c1"># OOI data set (stream) name </span>
<span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;.*deployment0002.*PHSEN.*</span><span class="se">\\</span><span class="s1">.nc$&#39;</span>  <span class="c1"># limit request to PHSEN NetCDF files from Deployment 2</span>

<span class="c1"># download the data from the OOI Gold Copy THREDDS server</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">load_gc_thredds</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

<span class="c1"># re-organize and rename the variables and add the quality checks</span>
<span class="n">phsen</span> <span class="o">=</span> <span class="n">phsen_datalogger</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">phsen</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phsen</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">phsen</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">6.9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">phsen</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">9.0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading 1 data file(s) from the OOI Gold Copy THREDSS catalog
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading and Processing the Data Files: 100%|██████████| 1/1 [00:00&lt;00:00,  1.29it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merging the data files into a single dataset
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Part of the <code class="docutils literal notranslate"><span class="pre">phsen_datalogger</span></code> module (imported above, and used to reorganize and restructure the data downloaded from OOI into a more useful form) is a function to assess the data quality. This function, called <code class="docutils literal notranslate"><span class="pre">quality_checks</span></code>, looks at select parameters (signal and reference channels) used to calculate the seawater pH and sets a QARTOD style quality flag for each data point. We can use the quality flags to quickly highlight data marked as <code class="docutils literal notranslate"><span class="pre">fail</span></code>, as in the plot below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the seawater pH values highlighting the &quot;bad&quot; data as defined by the quality checks</span>
<span class="n">bad</span> <span class="o">=</span> <span class="n">phsen</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">phsen</span><span class="o">.</span><span class="n">seawater_ph_quality_flag</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phsen</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">phsen</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Good&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bad</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">bad</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="s1">&#39;.r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fail&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Seawater pH&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fca3949e310&gt;
</pre></div>
</div>
<img alt="../../../../_images/466d79e622b0285b705ba1a637ff953219b1dc5e14aff4f5ed4dea46c48804d0.png" src="../../../../_images/466d79e622b0285b705ba1a637ff953219b1dc5e14aff4f5ed4dea46c48804d0.png" />
</div>
</div>
<p>Once we have created a time series of quality flags, we can take those a step further and use them to identify blocks, or groupings, of the <code class="docutils literal notranslate"><span class="pre">fail</span></code> data that can be used to generate an intial set of annotations for further Human in the Loop (HITL) reviews of the data. By blocks, we mean a semi-continuous period of time where consecutive data points are flagged as <code class="docutils literal notranslate"><span class="pre">fail</span></code>. Points are defined as consecutive if they occur within a certain time range of the preceding flagged point. This helps to eliminate times when the data is noisy and the flagging is inconsistent.</p>
<p>For the annotations, we are interested in periods of time where the duration of bad data points exceeds 24 hours, and there is more than 24 hours of time between each block (if not, the next set of bad points are added to the preceding block). The functions used to identify the blocks and then create the annotations are included in the <code class="docutils literal notranslate"><span class="pre">qc_processing</span></code> module (imported above).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a boolean array of the quality flag for just the failed data</span>
<span class="n">fail</span> <span class="o">=</span> <span class="n">phsen</span><span class="o">.</span><span class="n">seawater_ph_quality_flag</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">phsen</span><span class="o">.</span><span class="n">seawater_ph_quality_flag</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>

<span class="c1"># identify blocks of failed data points</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="n">identify_blocks</span><span class="p">(</span><span class="n">fail</span><span class="p">,</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>

<span class="c1"># use the identified blocks of data marked as &quot;fail&quot; to create initial HITL annotations for the pH data</span>
<span class="n">hitl</span> <span class="o">=</span> <span class="n">create_annotations</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span>
<span class="n">hitl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;id&#39;: [&#39;&#39;],
 &#39;subsite&#39;: [&#39;CE01ISSM&#39;],
 &#39;node&#39;: [&#39;RID16&#39;],
 &#39;sensor&#39;: [&#39;06-PHSEND000&#39;],
 &#39;method&#39;: [None],
 &#39;stream&#39;: [None],
 &#39;parameters&#39;: [[]],
 &#39;beginDT&#39;: [np.int64(1425501193000)],
 &#39;beginDate&#39;: [np.str_(&#39;2015-03-04T20:33:13&#39;)],
 &#39;endDT&#39;: [np.int64(1426419202000)],
 &#39;endDate&#39;: [np.str_(&#39;2015-03-15T11:33:22&#39;)],
 &#39;exclusionFlag&#39;: [&#39;False&#39;],
 &#39;qcFlag&#39;: [&#39;fail&#39;],
 &#39;source&#39;: [&#39;replace.me@whatever.com&#39;],
 &#39;annotation&#39;: [&#39;Based on a HITL review and automated quality assessments of the data, the data highlighted during this time period is considered inaccurate and users should avoid using the data as part of any analysis.&#39;]}
</pre></div>
</div>
</div>
</div>
<p>The above example works for just one deployment from back in 2015, but there have been several more since then. We can download all the pH data recorded from the Oregon Inshore Surface Mooring midwater platform from the different data delivery methods (helps to fill in gaps if telemetry or instrument data logging failed), merge the different data sets into a single record, create quality flags, and create initial HITL annotations for the entire record through the present.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># set a regex tag to limit the data download to just the PHSEN data for all deployments</span>
<span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;.*PHSEN.*</span><span class="se">\\</span><span class="s1">.nc$&#39;</span>

<span class="c1"># download the telemetered data and re-process it to create a more useful and coherent data set</span>
<span class="n">telem</span> <span class="o">=</span> <span class="n">load_gc_thredds</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="p">,</span> <span class="s1">&#39;telemetered&#39;</span><span class="p">,</span> <span class="s1">&#39;phsen_abcdef_dcl_instrument&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<span class="n">telem</span> <span class="o">=</span> <span class="n">phsen_datalogger</span><span class="p">(</span><span class="n">telem</span><span class="p">)</span>

<span class="c1"># download the recovered host data and re-process it to create a more useful and coherent data set</span>
<span class="n">rhost</span> <span class="o">=</span> <span class="n">load_gc_thredds</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="p">,</span> <span class="s1">&#39;recovered_host&#39;</span><span class="p">,</span> <span class="s1">&#39;phsen_abcdef_dcl_instrument_recovered&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<span class="n">rhost</span> <span class="o">=</span> <span class="n">phsen_datalogger</span><span class="p">(</span><span class="n">rhost</span><span class="p">)</span>

<span class="c1"># download the recovered instrument data and re-process it to create a more useful and coherent data set</span>
<span class="n">rinst</span> <span class="o">=</span> <span class="n">load_gc_thredds</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="p">,</span> <span class="s1">&#39;recovered_inst&#39;</span><span class="p">,</span> <span class="s1">&#39;phsen_abcdef_instrument&#39;</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
<span class="n">rinst</span> <span class="o">=</span> <span class="n">phsen_instrument</span><span class="p">(</span><span class="n">rinst</span><span class="p">)</span>

<span class="c1"># combine the three datasets into a single, merged time series, resampled to a 3 hour interval time series</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">combine_datasets</span><span class="p">(</span><span class="n">telem</span><span class="p">,</span> <span class="n">rhost</span><span class="p">,</span> <span class="n">rinst</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">6.9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">9.0</span><span class="p">))</span>

<span class="c1"># re-run the quality checks, since averaging will change the flag values</span>
<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;seawater_ph_quality_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quality_checks</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading 614 data file(s) from the OOI Gold Copy THREDSS catalog
Downloading and Processing the Data Files: 100%|██████████| 614/614 [00:42&lt;00:00, 14.55it/s]
Merging the data files into a single dataset
Downloading 25 data file(s) from the OOI Gold Copy THREDSS catalog
Downloading and Processing the Data Files: 100%|██████████| 25/25 [00:01&lt;00:00, 16.14it/s]
Merging the data files into a single dataset
Downloading 19 data file(s) from the OOI Gold Copy THREDSS catalog
Downloading and Processing the Data Files: 100%|██████████| 19/19 [00:00&lt;00:00, 21.52it/s]
Merging the data files into a single dataset
CPU times: user 1min 29s, sys: 1.98 s, total: 1min 31s
Wall time: 2min 14s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the HITL annotations for the entire record and convert them into a pandas dataframe</span>
<span class="n">fail</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">seawater_ph_quality_flag</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">seawater_ph_quality_flag</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="n">identify_blocks</span><span class="p">(</span><span class="n">fail</span><span class="p">,</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
<span class="n">hitl</span> <span class="o">=</span> <span class="n">create_annotations</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span>
<span class="n">hitl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">hitl</span><span class="p">)</span>
<span class="n">hitl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>subsite</th>
      <th>node</th>
      <th>sensor</th>
      <th>method</th>
      <th>stream</th>
      <th>parameters</th>
      <th>beginDT</th>
      <th>beginDate</th>
      <th>endDT</th>
      <th>endDate</th>
      <th>exclusionFlag</th>
      <th>qcFlag</th>
      <th>source</th>
      <th>annotation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1397768400000</td>
      <td>2014-04-17T21:00:00</td>
      <td>1408222800000</td>
      <td>2014-08-16T21:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1425502800000</td>
      <td>2015-03-04T21:00:00</td>
      <td>1426420800000</td>
      <td>2015-03-15T12:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1488218400000</td>
      <td>2017-02-27T18:00:00</td>
      <td>1490605200000</td>
      <td>2017-03-27T09:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1502150400000</td>
      <td>2017-08-08T00:00:00</td>
      <td>1502798400000</td>
      <td>2017-08-15T12:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>4</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1503262800000</td>
      <td>2017-08-20T21:00:00</td>
      <td>1503414000000</td>
      <td>2017-08-22T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>5</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1504504800000</td>
      <td>2017-09-04T06:00:00</td>
      <td>1507831200000</td>
      <td>2017-10-12T18:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>6</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1512550800000</td>
      <td>2017-12-06T09:00:00</td>
      <td>1512864000000</td>
      <td>2017-12-10T00:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>7</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1514300400000</td>
      <td>2017-12-26T15:00:00</td>
      <td>1522573200000</td>
      <td>2018-04-01T09:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>8</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1547424000000</td>
      <td>2019-01-14T00:00:00</td>
      <td>1547899200000</td>
      <td>2019-01-19T12:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>9</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1548201600000</td>
      <td>2019-01-23T00:00:00</td>
      <td>1548428400000</td>
      <td>2019-01-25T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>10</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1549076400000</td>
      <td>2019-02-02T03:00:00</td>
      <td>1549778400000</td>
      <td>2019-02-10T06:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>11</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1550026800000</td>
      <td>2019-02-13T03:00:00</td>
      <td>1552845600000</td>
      <td>2019-03-17T18:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>12</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1552953600000</td>
      <td>2019-03-19T00:00:00</td>
      <td>1553968800000</td>
      <td>2019-03-30T18:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>13</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1554195600000</td>
      <td>2019-04-02T09:00:00</td>
      <td>1554476400000</td>
      <td>2019-04-05T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>14</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1554681600000</td>
      <td>2019-04-08T00:00:00</td>
      <td>1555178400000</td>
      <td>2019-04-13T18:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>15</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1555383600000</td>
      <td>2019-04-16T03:00:00</td>
      <td>1555545600000</td>
      <td>2019-04-18T00:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>16</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1561604400000</td>
      <td>2019-06-27T03:00:00</td>
      <td>1571648400000</td>
      <td>2019-10-21T09:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>17</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1578830400000</td>
      <td>2020-01-12T12:00:00</td>
      <td>1579046400000</td>
      <td>2020-01-15T00:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>18</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1599588000000</td>
      <td>2020-09-08T18:00:00</td>
      <td>1600182000000</td>
      <td>2020-09-15T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>19</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1608066000000</td>
      <td>2020-12-15T21:00:00</td>
      <td>1608206400000</td>
      <td>2020-12-17T12:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>20</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1619092800000</td>
      <td>2021-04-22T12:00:00</td>
      <td>1620313200000</td>
      <td>2021-05-06T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>21</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1620464400000</td>
      <td>2021-05-08T09:00:00</td>
      <td>1620572400000</td>
      <td>2021-05-09T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>22</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1620680400000</td>
      <td>2021-05-10T21:00:00</td>
      <td>1620939600000</td>
      <td>2021-05-13T21:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>23</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1621047600000</td>
      <td>2021-05-15T03:00:00</td>
      <td>1632139200000</td>
      <td>2021-09-20T12:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>24</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1643511600000</td>
      <td>2022-01-30T03:00:00</td>
      <td>1644580800000</td>
      <td>2022-02-11T12:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>25</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1670284800000</td>
      <td>2022-12-06T00:00:00</td>
      <td>1679238000000</td>
      <td>2023-03-19T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>26</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1680264000000</td>
      <td>2023-03-31T12:00:00</td>
      <td>1681840800000</td>
      <td>2023-04-18T18:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>27</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1681970400000</td>
      <td>2023-04-20T06:00:00</td>
      <td>1684648800000</td>
      <td>2023-05-21T06:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>28</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1686063600000</td>
      <td>2023-06-06T15:00:00</td>
      <td>1686171600000</td>
      <td>2023-06-07T21:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>29</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1686452400000</td>
      <td>2023-06-11T03:00:00</td>
      <td>1686873600000</td>
      <td>2023-06-16T00:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>30</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1687543200000</td>
      <td>2023-06-23T18:00:00</td>
      <td>1689109200000</td>
      <td>2023-07-11T21:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>31</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1690027200000</td>
      <td>2023-07-22T12:00:00</td>
      <td>1696010400000</td>
      <td>2023-09-29T18:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>32</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1697112000000</td>
      <td>2023-10-12T12:00:00</td>
      <td>1697360400000</td>
      <td>2023-10-15T09:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>33</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1697878800000</td>
      <td>2023-10-21T09:00:00</td>
      <td>1697997600000</td>
      <td>2023-10-22T18:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>34</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1698386400000</td>
      <td>2023-10-27T06:00:00</td>
      <td>1700103600000</td>
      <td>2023-11-16T03:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>35</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1700265600000</td>
      <td>2023-11-18T00:00:00</td>
      <td>1700838000000</td>
      <td>2023-11-24T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>36</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1701021600000</td>
      <td>2023-11-26T18:00:00</td>
      <td>1702166400000</td>
      <td>2023-12-10T00:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>37</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1715245200000</td>
      <td>2024-05-09T09:00:00</td>
      <td>1715590800000</td>
      <td>2024-05-13T09:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>38</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1724587200000</td>
      <td>2024-08-25T12:00:00</td>
      <td>1724706000000</td>
      <td>2024-08-26T21:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>39</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1727924400000</td>
      <td>2024-10-03T03:00:00</td>
      <td>1728032400000</td>
      <td>2024-10-04T09:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We now have record of 6+ years worth of data, with most of the bad data identified and initial HITL annotations with which to work. We can download the existing annotations from the system and combine them with the ones just created. Outside of this notebook, then, the next step would be to save these combined annotations and use them to review the data in much greater depth to confirm the quality flags and the indentified blocks. This would be the HITL process. Rather than saving and reviewing them, for the purposes of this notebook, we’ll just display and use them as-is.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the current system annotations for the sensor</span>
<span class="n">annotations</span> <span class="o">=</span> <span class="n">get_annotations</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="p">)</span>
<span class="n">annotations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">annotations</span><span class="p">)</span>
<span class="n">annotations</span> <span class="o">=</span> <span class="n">annotations</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;@class&#39;</span><span class="p">])</span>
<span class="n">annotations</span><span class="p">[</span><span class="s1">&#39;beginDate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">annotations</span><span class="o">.</span><span class="n">beginDT</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span>
<span class="n">annotations</span><span class="p">[</span><span class="s1">&#39;endDate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">annotations</span><span class="o">.</span><span class="n">endDT</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span>

<span class="c1"># append the fail annotations to the existing annotations</span>
<span class="n">annotations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">annotations</span><span class="p">,</span> <span class="n">hitl</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># set the annotation column orders</span>
<span class="n">header_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;subsite&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;sensor&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;stream&#39;</span><span class="p">,</span> <span class="s1">&#39;parameters&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;beginDT&#39;</span><span class="p">,</span> <span class="s1">&#39;beginDate&#39;</span><span class="p">,</span> <span class="s1">&#39;endDT&#39;</span><span class="p">,</span> <span class="s1">&#39;endDate&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusionFlag&#39;</span><span class="p">,</span> <span class="s1">&#39;qcFlag&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;annotation&#39;</span><span class="p">]</span>
<span class="n">annotations</span> <span class="o">=</span> <span class="n">annotations</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">header_names</span><span class="p">)</span>
<span class="n">annotations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>subsite</th>
      <th>node</th>
      <th>sensor</th>
      <th>method</th>
      <th>stream</th>
      <th>parameters</th>
      <th>beginDT</th>
      <th>beginDate</th>
      <th>endDT</th>
      <th>endDate</th>
      <th>exclusionFlag</th>
      <th>qcFlag</th>
      <th>source</th>
      <th>annotation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1697</td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1560643200000</td>
      <td>2019-06-16T00:00:00</td>
      <td>1.571789e+12</td>
      <td>2019-10-22T23:57:00</td>
      <td>False</td>
      <td>suspect</td>
      <td>wingardc@oregonstate.edu</td>
      <td>Data indicates the sensor has either fouled or...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2342</td>
      <td>CE01ISSM</td>
      <td>None</td>
      <td>None</td>
      <td>recovered_host</td>
      <td>None</td>
      <td>[]</td>
      <td>1485949200000</td>
      <td>2017-02-01T11:40:00</td>
      <td>1.492458e+12</td>
      <td>2017-04-17T19:45:00</td>
      <td>False</td>
      <td>not_operational</td>
      <td>wingardc@oregonstate.edu</td>
      <td>The buoy and mfn battery voltages have been dr...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1893</td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1578768300000</td>
      <td>2020-01-11T18:45:00</td>
      <td>1.594656e+12</td>
      <td>2020-07-13T16:00:00</td>
      <td>False</td>
      <td>not_operational</td>
      <td>wingardc@oregonstate.edu</td>
      <td>During a large storm event on 2020-01-11, the ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>871</td>
      <td>CE01ISSM</td>
      <td>None</td>
      <td>None</td>
      <td>telemetered</td>
      <td>None</td>
      <td>[]</td>
      <td>1485949200000</td>
      <td>2017-02-01T11:40:00</td>
      <td>1.492458e+12</td>
      <td>2017-04-17T19:45:00</td>
      <td>False</td>
      <td>not_operational</td>
      <td>michaesm@marine.rutgers.edu</td>
      <td>The buoy and mfn battery voltages have been dr...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>868</td>
      <td>CE01ISSM</td>
      <td>None</td>
      <td>None</td>
      <td>telemetered</td>
      <td>None</td>
      <td>[]</td>
      <td>1397767500000</td>
      <td>2014-04-17T20:45:00</td>
      <td>1.408228e+12</td>
      <td>2014-08-16T22:30:00</td>
      <td>False</td>
      <td>not_available</td>
      <td>michaesm@marine.rutgers.edu</td>
      <td>Due to a bug in the mooring telemetry code, a ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>61</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1700265600000</td>
      <td>2023-11-18T00:00:00</td>
      <td>1.700838e+12</td>
      <td>2023-11-24T15:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>62</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1701021600000</td>
      <td>2023-11-26T18:00:00</td>
      <td>1.702166e+12</td>
      <td>2023-12-10T00:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>63</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1715245200000</td>
      <td>2024-05-09T09:00:00</td>
      <td>1.715591e+12</td>
      <td>2024-05-13T09:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>64</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1724587200000</td>
      <td>2024-08-25T12:00:00</td>
      <td>1.724706e+12</td>
      <td>2024-08-26T21:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
    <tr>
      <th>65</th>
      <td></td>
      <td>CE01ISSM</td>
      <td>RID16</td>
      <td>06-PHSEND000</td>
      <td>None</td>
      <td>None</td>
      <td>[]</td>
      <td>1727924400000</td>
      <td>2024-10-03T03:00:00</td>
      <td>1.728032e+12</td>
      <td>2024-10-04T09:00:00</td>
      <td>False</td>
      <td>fail</td>
      <td>replace.me@whatever.com</td>
      <td>Based on a HITL review and automated quality a...</td>
    </tr>
  </tbody>
</table>
<p>66 rows × 15 columns</p>
</div></div></div>
</div>
<p>An additional function in the <code class="docutils literal notranslate"><span class="pre">common</span></code> module, called <code class="docutils literal notranslate"><span class="pre">add_annotation_qc_flags</span></code> can be used to add the annotations from above into the data set using a QARTOD flag value to represent the annotations qcFlag value. Those annotation flags, and the quality flags created above, can be used to create a final, cleaned up data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use the annotation blocks created created above and merged with the existing system </span>
<span class="c1"># annotations to create an annotation based QC flag.</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">add_annotation_qc_flags</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">annotations</span><span class="p">)</span>

<span class="c1"># create a &quot;good&quot; dataset excluding data marked as &quot;fail&quot; either from the quality checks or the annotations</span>
<span class="n">good</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">merged</span><span class="o">.</span><span class="n">seawater_ph_quality_flag</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">rollup_annotations_qc_results</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can take a look at how we’ve done.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the 6+ years of seawater pH values highlighting the &quot;fail&quot; data as defined by the quality checks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="s1">&#39;.r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fail&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">good</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">good</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Good&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Seawater pH&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc9721ee150&gt;
</pre></div>
</div>
<img alt="../../../../_images/ab61ff13205c4adf7d2d7e36cee9835fc4164165425e5ded3981b0f2442ecccf.png" src="../../../../_images/ab61ff13205c4adf7d2d7e36cee9835fc4164165425e5ded3981b0f2442ecccf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the seawater pH as a function of temperature, again highlighting the &quot;fail&quot; data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;thermistor_temperature&#39;</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="s1">&#39;.r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fail&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">good</span><span class="p">[</span><span class="s1">&#39;thermistor_temperature&#39;</span><span class="p">],</span> <span class="n">good</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Good&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Seawater Temperature ($^\circ$C)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Seawater pH&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc99c53ead0&gt;
</pre></div>
</div>
<img alt="../../../../_images/3b4d7336f663303e9c23dadba09d81fa94498f38bab870bd8b7c71b164c00e22.png" src="../../../../_images/3b4d7336f663303e9c23dadba09d81fa94498f38bab870bd8b7c71b164c00e22.png" />
</div>
</div>
<p>If we eliminate the failed data from further consideration, and take a different look at the plot above (using the month of the year to color the points), an interesting pattern starts to emerge from the noisiness above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the &quot;good&quot; seawater pH as a function of temperature, converted to daily, median averages.</span>
<span class="c1"># plus, let&#39;s see if we can tease out any seasonality to the temperature/pH relationship</span>
<span class="n">daily</span> <span class="o">=</span> <span class="n">good</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">doy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">274</span><span class="p">,</span> <span class="mi">305</span><span class="p">,</span> <span class="mi">335</span><span class="p">]</span>
<span class="n">cmnth</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">daily</span><span class="p">[</span><span class="s1">&#39;thermistor_temperature&#39;</span><span class="p">],</span> <span class="n">daily</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">daily</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">doy</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">cmnth</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Seawater Temperature ($^\circ$C)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Seawater pH&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7.0, 9.0)
</pre></div>
</div>
<img alt="../../../../_images/777b0cb9dd4ced72d634179e74272e6742bb93b77c990d7b8e7bf7332840517a.png" src="../../../../_images/777b0cb9dd4ced72d634179e74272e6742bb93b77c990d7b8e7bf7332840517a.png" />
</div>
</div>
<p>In addition to cleaning up the data for scientific use, we can also use the cleaned up data to help generate values for the QARTOD gross range and climatology tests OOI is in the process of implementing. The gross range test uses a fail_span value set from the vendor documentation and a suspect_span value set from the mean of all of the data collected through 2021-01-01, plus/minus 3 standard deviations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># limit the time range and calculate the gross range values</span>
<span class="n">good</span> <span class="o">=</span> <span class="n">good</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s2">&quot;2014-01-01T00:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;2021-01-01T00:00:00&quot;</span><span class="p">))</span>
<span class="n">gr</span> <span class="o">=</span> <span class="n">process_gross_range</span><span class="p">(</span><span class="n">good</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.9</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">],</span> <span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="n">sensor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing data for normality: seawater_ph
[########################################] | 100% Completed | 1.32 sms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">qcConfig</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;qartod&#39;: {&#39;gross_range_test&#39;: {&#39;suspect_span&#39;: [np.float64(7.4863), np.float64(8.56264)], &#39;fail_span&#39;: [6.9, 9.0]}}}]
</pre></div>
</div>
</div>
</div>
<p>The climatology test uses a monthly range of data points, derived from a two-cycle harmonic fit to monthly means of the data plus/minus 3x the monthly standard deviations. These values are then saved to a table organized by the month.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># develop ranges for the QARTOD climatology test</span>
<span class="n">clm</span><span class="p">,</span> <span class="n">clm_table</span> <span class="o">=</span> <span class="n">process_climatology</span><span class="p">(</span><span class="n">good</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.9</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">],</span> <span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">sensor</span><span class="o">=</span><span class="n">sensor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">clm_table</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>,&quot;[1, 1]&quot;,&quot;[2, 2]&quot;,&quot;[3, 3]&quot;,&quot;[4, 4]&quot;,&quot;[5, 5]&quot;,&quot;[6, 6]&quot;,&quot;[7, 7]&quot;,&quot;[8, 8]&quot;,&quot;[9, 9]&quot;,&quot;[10, 10]&quot;,&quot;[11, 11]&quot;,&quot;[12, 12]&quot;
&quot;[0, 0]&quot;,&quot;[7.91743, 8.14042]&quot;,&quot;[7.79856, 8.24695]&quot;,&quot;[7.79968, 8.30575]&quot;,&quot;[7.77445, 8.37024]&quot;,&quot;[7.40135, 8.65953]&quot;,&quot;[7.18680, 8.67460]&quot;,&quot;[7.12786, 8.54873]&quot;,&quot;[7.22312, 8.42472]&quot;,&quot;[7.21518, 8.58274]&quot;,&quot;[7.71801, 8.29173]&quot;,&quot;[7.85751, 8.27712]&quot;,&quot;[7.85285, 8.27126]&quot;
</pre></div>
</div>
</div>
</div>
<p>To put this all together, so a user can see what the data looks like in the context of the QARTOD tests, we need to directly work with the climatology code, and do some re-arranging of the results…so…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ooi_data_explorations.qartod.climatology</span><span class="w"> </span><span class="kn">import</span> <span class="n">Climatology</span>
<span class="n">clm</span> <span class="o">=</span> <span class="n">Climatology</span><span class="p">()</span>
<span class="n">clm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">good</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">])</span>
<span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">clm</span><span class="o">.</span><span class="n">regression</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;beta&#39;: array([ 7.98610723, -0.09531616,  0.03374029,  0.04217056,  0.05249922,
         0.0242958 , -0.01679743,  0.00931113,  0.0118164 ]),
 &#39;residuals&#39;: array([0.34604929]),
 &#39;rank&#39;: np.int32(9),
 &#39;singular_values&#39;: array([8.09951668, 6.40446115, 6.19376558, 5.75271583, 5.51420523,
        5.45714535, 5.16916117, 4.94454061, 4.53526533]),
 &#39;variance_explained&#39;: array([0.58156015])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">monthly_std</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span> <span class="n">clm</span><span class="o">.</span><span class="n">monthly_std</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">monthly_std</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">monthly_std</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">monthly_std</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> 
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">monthly_std</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">monthly_std</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">monthly_std</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">good</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">good</span><span class="p">[</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Climatology Mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="s1">&#39;-g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Climatology Range&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="s1">&#39;-g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">7.45</span><span class="p">,</span> <span class="mi">82</span><span class="p">),</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Suspect Range&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">8.53</span><span class="p">,</span> <span class="mi">82</span><span class="p">),</span> <span class="s1">&#39;-c&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">6.9</span><span class="p">,</span> <span class="mi">82</span><span class="p">),</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fail Range&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">fitted_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">82</span><span class="p">),</span> <span class="s1">&#39;-m&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Seawater pH&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6.5, 9.5)
</pre></div>
</div>
<img alt="../../../../_images/ff17bbf1d05e18efed45d4f073553e13bdf3653323d4c40485fd3bddd4ae12c8.png" src="../../../../_images/ff17bbf1d05e18efed45d4f073553e13bdf3653323d4c40485fd3bddd4ae12c8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot up the monthly means and the climatology fit to get a better understanding of the data and the </span>
<span class="c1"># quality of the fit</span>
<span class="n">mnthly</span> <span class="o">=</span> <span class="n">good</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">grps</span> <span class="o">=</span> <span class="n">mnthly</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clm</span><span class="o">.</span><span class="n">monthly_fit</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">clm</span><span class="o">.</span><span class="n">monthly_fit</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;2-Cycle: R$^2$ = 0.54&#39;</span><span class="p">)</span>
<span class="n">xtic</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">grps</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">to_index</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">grp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;seawater_ph&#39;</span><span class="p">],</span> <span class="s1">&#39;.k&#39;</span><span class="p">)</span>
    <span class="n">xtic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">to_index</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">to_index</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Monthly Mean Observations and the Climatological Fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Seawater pH&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xtic</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">7.4</span><span class="p">,</span> <span class="mf">8.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc8c1ddf350&gt;
</pre></div>
</div>
<img alt="../../../../_images/9c0a83f55905137d503e09223f680e6a662ad0f7d303a4ba90eacd58ee2b1df8.png" src="../../../../_images/9c0a83f55905137d503e09223f680e6a662ad0f7d303a4ba90eacd58ee2b1df8.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "fdchp"
        },
        kernelOptions: {
            name: "fdchp",
            path: "./python/examples/notebooks/phsen"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'fdchp'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../pco2w/PCO2_Calculations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Assessing the pCO2 Data for the CE01ISSM-00011 7 m Platform (NSIF)</p>
      </div>
    </a>
    <a class="right-next"
       href="../ifcb/combining_ifcb_and_environmental.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Linking IFCB Targets to in-situ Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#oregon-inshore-midwater-platform">Oregon Inshore Midwater Platform</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ocean Observatories Initiative
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>